â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DOMAIN: audit
Total Stories: 3
Generated: dim. 18 janv. 2026 12:03:02 EST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ISSUE #105: [FRONTEND] [STORY] Security: Immutable Audit Trail for Price/Cost Changes and Rule Evaluations  
File: ./scripts/story-work/frontend/105/after.md
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STOP: Clarification required before finalization

## ğŸ·ï¸ Labels (Proposed)

### Required
- type:story
- domain:audit
- status:draft

### Recommended
- agent:audit-domain-agent
- agent:story-authoring

### Blocking / Risk
- blocked:clarification
- risk:incomplete-requirements

**Rewrite Variant:** security-strict

---

## 1. Story Header

### Title
[FRONTEND] Immutable Audit Trail UI for Price/Cost Changes + Pricing Rule Evaluation Trace (Snapshot Drilldown + Search)

### Primary Persona
Auditor

### Business Value
Provide verifiable, immutable evidence for price/cost changes and â€œhow price was calculatedâ€ rule traces so margin disputes and compliance investigations can be resolved with defensible, searchable records.

---

## 2. Story Intent

### As a / I want / So that
- **As an** Auditor  
- **I want** to search immutable audit history for pricing/cost changes and drill from an estimate lineâ€™s `snapshotId` into the stored pricing snapshot and rule evaluation trace  
- **So that** I can explain pricing outcomes, validate margin calculations, and resolve disputes with unalterable evidence.

### In-scope
- New/updated **Moqui screens** for:
  - Searching audit records by product, location, and date range
  - Viewing an **audit record detail** (normalized fields + raw payload)
  - Viewing a **Pricing Snapshot** by `snapshotId` and its associated **Pricing Rule Trace**
  - Drill path: **estimate line â†’ snapshot â†’ rule trace** (read-only)
- Frontend enforcement of immutability expectations (no edit/delete UI; handle forbidden responses deterministically).
- Standard pagination, sorting, empty states, and error handling for audit query and detail views.

### Out-of-scope
- Implementing audit ingestion, retention enforcement, or immutability storage controls (backend responsibility).
- Defining or changing pricing rule logic.
- Creating/modifying audit records from the UI (this story is read/query/drilldown focused).
- Managing reason-code registry UI (not requested in provided inputs).

---

## 3. Actors & Stakeholders
- **Auditor (primary)**: reads/searches audit and pricing trace evidence.
- **Shop Manager / Support (secondary)**: may use the same UI to investigate disputes (authorization-dependent).
- **Pricing domain (stakeholder)**: producer of price/cost change events and pricing snapshot/trace records.
- **Workexec domain (stakeholder)**: stores `snapshotId` on estimate line(s); UI must drill from that reference.

---

## 4. Preconditions & Dependencies
- User is authenticated and authorized to access audit query/detail endpoints.
- Backend provides query/detail APIs for:
  - Audit log search (filter by product/location/date; plus any additional filters used by UI)
  - Pricing snapshot retrieval by `snapshotId`
  - Pricing rule trace retrieval (either embedded in snapshot response or via `ruleTraceId`)
- Workexec/estimate-line UI has access to the estimate lineâ€™s `snapshotId` (already stored) and provides an entry point (link/button) to open the snapshot/trace view.

---

## 5. UX Summary (Moqui-Oriented)

### Entry points
1. **Audit Search**: POS navigation entry â€œAuditâ€ (or â€œCompliance/Auditâ€) leading to an audit search/list screen.
2. **Estimate Line Drilldown**: From an estimate line details context (Workexec screen), a â€œView Pricing Traceâ€ action when `snapshotId` is present.

### Screens to create/modify
- **Create:** `apps/pos/audit/AuditSearch.xml` (screen)
  - Search form + results list
- **Create:** `apps/pos/audit/AuditDetail.xml` (screen)
  - View a single audit event by `eventId`
- **Create:** `apps/pos/audit/PricingSnapshotDetail.xml` (screen)
  - View PricingSnapshot by `snapshotId` + linked PricingRuleTrace
- **Modify (dependency):** Workexec estimate line screen to add navigation to `PricingSnapshotDetail` using `snapshotId` (screen name/path TBD)

### Navigation context
- Audit screens live under an audit module/menu, scoped by tenant/location context (if POS has a current location selector).
- Detail screens are deep-linkable with parameters:
  - `eventId` for AuditDetail
  - `snapshotId` for PricingSnapshotDetail

### User workflows
**Happy path A â€” Search audit**
1. Auditor opens Audit Search.
2. Sets filters: `productId` (or SKU), `locationId`, `fromDateTime`, `toDateTime`.
3. Submits â†’ sees paginated reverse-chronological results.
4. Clicks a row â†’ Audit Detail.

**Happy path B â€” Drill estimate line â†’ snapshot â†’ rule trace**
1. Auditor opens an estimate line in Workexec.
2. Clicks â€œView Pricing Traceâ€ (visible only if `snapshotId` exists).
3. Pricing Snapshot Detail loads snapshot + trace.
4. Auditor views rule evaluation steps (read-only).

**Alternate path â€” Missing snapshot**
- If `snapshotId` is absent, the action is hidden/disabled with an explanatory tooltip or inline message.

---

## 6. Functional Behavior

### Triggers
- User navigates to audit search screen.
- User submits search filters.
- User opens audit detail by `eventId`.
- User opens pricing snapshot detail by `snapshotId` (from Workexec or direct URL).

### UI actions
- Search form submit triggers a Moqui transition that calls a service to query audit logs.
- Selecting a row navigates to detail screen with `eventId`.
- â€œView raw payloadâ€ toggles visibility of raw JSON (read-only, copyable).

### State changes
- No domain state changes are performed by the UI (read-only).
- UI maintains view state: selected filters, current page, sorting.

### Service interactions (frontend â†” Moqui)
- Screen actions use Moqui `transition` + `service-call` to backend services (names TBD; see Open Questions).
- Responses mapped into screen context for rendering lists/details.

---

## 7. Business Rules (Translated to UI Behavior)

### Validation
- **Date range required** for audit searches:
  - UI must require `fromDateTime` and `toDateTime` (or apply backend default if backend enforces last-90-days; see Open Questions).
  - Validate `fromDateTime <= toDateTime`.
- **At least one primary filter** must be provided to avoid unbounded scans:
  - Must include at least one of: `productId` (or SKU/productRef), `locationId` (if not implicitly scoped), `eventType`, `actorId`, `entityId`, or `snapshotId` (if supported).
  - If only date range is provided, UI should block submission with a clear message (unless backend explicitly allows).

### Enable/disable rules
- â€œView Pricing Traceâ€ is enabled only when estimate line has a non-empty `snapshotId`.
- No edit/delete controls exist on audit/snapshot/trace screens.
- Any UI affordance to â€œmodifyâ€ should be absent; if user attempts via URL/method, handle 403/405 gracefully.

### Visibility rules
- If user lacks permission (403) for audit screens: show an â€œAccess deniedâ€ page state (standard POS unauthorized state).
- If `snapshotId` not found: show â€œSnapshot not foundâ€ with guidance (cannot proceed).

### Error messaging expectations
- Validation errors: inline form errors and a summary message.
- Backend 401 â†’ redirect to login/session restore flow (project standard).
- Backend 403 â†’ show forbidden/insufficient permissions.
- Backend 404 (eventId/snapshotId not found) â†’ show not-found empty state.
- Backend 5xx/timeouts â†’ show retry action; do not expose stack traces.

---

## 8. Data Requirements

### Entities involved (logical; UI consumes)
- `AuditLog` (immutable log entry)
- `PricingSnapshot`
- `PricingRuleTrace`

### Fields (type, required, defaults)
**AuditLog (list + detail)**
- `eventId` (string/UUID, required, read-only)
- `timestamp`/`occurredAt` (datetime UTC, required, read-only)
- `eventType` (string, required)
- `actorId` (string, required)
- `entityType` (string, required)
- `entityId` (string, required)
- `locationId` (string, required for filtering/display if available)
- `changeSummary` (text/JSON, optional; display if present)
- `oldValue` (JSON, optional; detail only)
- `newValue` (JSON, optional; detail only)
- `rawPayload` (JSON/text, optional; detail only)

**PricingSnapshot (detail)**
- `snapshotId` (string/UUID, required)
- `timestamp` (datetime UTC, required)
- `quoteContext` (JSON, required/optional? TBD by backend)
- `finalPrice` (money, optional)
- `ruleTraceId` (string/UUID, required if trace not embedded)

**PricingRuleTrace (embedded or separate)**
- `ruleTraceId` (string/UUID, required)
- `evaluationSteps` (array, required; can be empty)
  - Each step: `ruleId` (string), `status` (enum APPLIED/REJECTED/SKIPPED), `inputs` (JSON), `outputs` (JSON)

### Read-only vs editable by state/role
- All fields read-only for all roles in this story.
- Any attempt to mutate is out of scope; UI should not present mutation capabilities.

### Derived/calculated fields
- Display-friendly timestamp formatting (viewer timezone) while preserving UTC in raw view.
- Optional computed â€œChanged Field Countâ€ if backend provides structured diff (TBD; do not invent).

---

## 9. Service Contracts (Frontend Perspective)

> Concrete service names/paths are not provided in inputs. The frontend must integrate with Moqui services that wrap backend APIs. Final contract requires clarification.

### Load/view calls
- `audit.search` (TBD): returns paginated audit records.
  - Inputs: `fromDateTime`, `toDateTime`, `productId` and/or `locationId`, pagination (`pageIndex/pageSize`), sort (default `occurredAt desc`)
- `audit.get#eventId` (TBD): returns audit record detail including raw payload.
- `pricingSnapshot.get#snapshotId` (TBD): returns PricingSnapshot and either embeds rule trace or returns `ruleTraceId`.
- `pricingRuleTrace.get#ruleTraceId` (TBD): returns full evaluation steps (if not embedded).

### Create/update calls
- none (read-only story).

### Submit/transition calls
- Moqui `transition` actions:
  - `AuditSearch` screen `search` transition â†’ calls `audit.search`
  - `AuditDetail` screen `load` transition â†’ calls `audit.get`
  - `PricingSnapshotDetail` screen `load` transition â†’ calls `pricingSnapshot.get` and optionally `pricingRuleTrace.get`

### Error handling expectations
- Map backend error shapes into:
  - Field-level errors for 400 validation responses (if backend returns field details).
  - Global toast/banner for unexpected errors.
- Handle 403/405 on any â€œmutatingâ€ attempt as forbidden; ensure UI never calls such endpoints from these screens.

---

## 10. State Model & Transitions

### Allowed states
- Not applicable (audit entries/snapshots are immutable records; UI is read-only).

### Role-based transitions
- `Auditor` role can access:
  - Audit search/list
  - Audit detail
  - Pricing snapshot/trace detail (if authorized)
- If other roles are allowed, must be confirmed (see Open Questions).

### UI behavior per state
- N/A beyond authorized/unauthorized and found/not-found.

---

## 11. Alternate / Error Flows

### Validation failures (client-side)
- Missing required date range â†’ block search submit; show inline errors.
- Invalid range (`from > to`) â†’ block; show inline errors.
- Missing primary filter (only date range) â†’ block; show message explaining need for at least one filter.

### Concurrency conflicts
- N/A (read-only). If backend indicates record deleted (should not happen for audit), treat as 404.

### Unauthorized access
- 401: user must re-authenticate.
- 403: show Access Denied; do not leak whether eventId/snapshotId exists.

### Empty states
- Search yields 0 results: show â€œNo audit records found for given filtersâ€ and keep filters visible.
- Snapshot exists but trace missing: show snapshot, and a â€œTrace unavailableâ€ section with guidance (and log correlationId if present).

---

## 12. Acceptance Criteria (Gherkin)

### Scenario 1: Search audit logs by product/location/date
**Given** an Auditor is authenticated and authorized to view audit logs  
**And** the Auditor is on the Audit Search screen  
**When** the Auditor enters a valid `fromDateTime` and `toDateTime`  
**And** selects a `locationId`  
**And** enters a `productId`  
**And** submits the search  
**Then** the system displays a paginated list of matching immutable audit records  
**And** the results are sorted by occurred timestamp descending by default

### Scenario 2: Prevent unbounded audit searches
**Given** an Auditor is on the Audit Search screen  
**When** the Auditor enters only a date range with no other filter  
**And** submits the search  
**Then** the UI blocks the request  
**And** displays a message requiring at least one additional filter (e.g., product or location)

### Scenario 3: View audit record detail
**Given** an Auditor has performed a search and sees an audit record with an `eventId`  
**When** the Auditor opens the audit record detail  
**Then** the system shows the audit record fields as read-only  
**And** includes the raw payload (if available) in a read-only view

### Scenario 4: Drill from estimate line to pricing snapshot and rule trace
**Given** an Auditor is viewing an estimate line that contains a `snapshotId`  
**When** the Auditor selects â€œView Pricing Traceâ€  
**Then** the system loads the Pricing Snapshot for that `snapshotId`  
**And** displays the associated Pricing Rule Trace evaluation steps as read-only

### Scenario 5: Snapshot not found
**Given** an Auditor navigates to the Pricing Snapshot Detail screen with a `snapshotId` that does not exist  
**When** the screen loads  
**Then** the system displays a â€œSnapshot not foundâ€ state  
**And** does not display any stale or partial trace data

### Scenario 6: Unauthorized access handling
**Given** a user without audit permissions navigates to the Audit Search screen  
**When** the screen attempts to load or query audit data  
**Then** the system displays an access denied state (403 handling)  
**And** no audit data is shown

---

## 13. Audit & Observability

### User-visible audit data
- Display normalized audit metadata (eventId, occurredAt/timestamp, actor, entity, location, eventType).
- Provide raw payload view for evidentiary inspection (read-only).

### Status history
- Not applicable; audit records are immutable entries, but UI should show occurredAt and emittedAt if provided (TBD).

### Traceability expectations
- From estimate line: `snapshotId` must be shown (or accessible) and used as the drill key.
- Where available, display `correlationId` and `sourceSystem` for cross-system tracing (backend-provided).

---

## 14. Non-Functional UI Requirements

### Performance
- Audit search must support pagination; default page size (TBD) and a maximum page size enforced by UI control.
- Avoid rendering extremely large JSON blobs by default: raw payload collapsed by default with â€œexpand/copyâ€ actions.

### Accessibility
- All interactive controls keyboard accessible.
- JSON/raw payload view supports copy and is readable with screen readers (use proper labels).

### Responsiveness
- Screens usable on tablet sizes typical in POS environments; long JSON uses scroll containers.

### i18n/timezone/currency
- Timestamps displayed in userâ€™s locale/timezone with UTC shown or available in raw detail.
- Money fields (finalPrice) display using tenant currency settings (TBD; do not assume).

---

## 15. Applied Safe Defaults
- **SD-UX-EMPTY-STATE**: Provide consistent empty/loading/error states for list/detail screens; safe because it doesnâ€™t alter domain behavior. (Impacted: UX Summary, Alternate/Error Flows)
- **SD-UX-PAGINATION**: Use standard pagination controls and default sort descending by occurred timestamp; safe because it affects only presentation and query parameters. (Impacted: UX Summary, Service Contracts, Acceptance Criteria)
- **SD-ERR-MAP**: Map HTTP 401/403/404/5xx to standard POS UI states; safe because itâ€™s generic error handling without changing business policy. (Impacted: Business Rules, Alternate/Error Flows)

---

## 16. Open Questions

1. **API/service contract**: What are the exact Moqui service names and request/response shapes for:
   - audit search (filters, pagination, sort)
   - audit detail by `eventId`
   - pricing snapshot by `snapshotId`
   - rule trace retrieval (embedded vs separate)?
2. **Date range rule**: Must the UI enforce a mandatory date range and â€œat least one indexed filterâ€, or does backend enforce defaults (e.g., last 90 days) and guardrails? Provide the canonical rule for audit queries in this product.
3. **Product identifier**: Should search filter use `productId`, SKU, part number, or multiple? What is the user-facing identifier in POS?
4. **Location scoping**: Is `locationId` implicitly derived from the current POS location context, or must it be selectable as a filter? Can auditors search across locations?
5. **Authorization**: Which roles besides â€œAuditorâ€ are allowed to access audit search/detail and snapshot/trace screens (Shop Manager, Support)? Provide role names used in Moqui security groups.
6. **Workexec integration point**: Which exact Workexec screen/component should add â€œView Pricing Traceâ€, and what parameter name holds the snapshot reference (`snapshotId` exactly)?
7. **Trace format**: For `evaluationSteps`, what fields are guaranteed and what is the maximum expected size? Should the UI provide step filtering (applied-only) or is full list always required?

---

## Original Story (Unmodified â€“ For Traceability)

Title: [FRONTEND] [STORY] Security: Immutable Audit Trail for Price/Cost Changes and Rule Evaluations  
URL: https://github.com/louisburroughs/durion-moqui-frontend/issues/105  
Labels: frontend, story-implementation, user

## Frontend Implementation for Story

**Original Story**: [STORY] Security: Immutable Audit Trail for Price/Cost Changes and Rule Evaluations

**Domain**: user

### Story Description

/kiro
# User Story
## Narrative
As an **Auditor**, I want immutable history and pricing-rule traces so that we can explain margins and resolve disputes.

## Details
- Append-only audit for price books, overrides, costs.
- Keep evaluation traces for pricing quotes (rule trace).

## Acceptance Criteria
- Audit is append-only.
- Drill estimate line â†’ snapshot â†’ rule trace.
- Search by product/location/date.

## Integrations
- Workexec stores snapshotId for traceability.

## Data / Entities
- AuditLog, PricingRuleTrace, PricingSnapshot

## Classification (confirm labels)
- Type: Story
- Layer: Domain
- Domain: Product / Parts Management


### Frontend Requirements

- Implement Vue.js 3 components with TypeScript
- Use Quasar framework for UI components
- Integrate with Moqui Framework backend
- Ensure responsive design and accessibility

### Technical Stack

- Vue.js 3 with Composition API
- TypeScript 5.x
- Quasar v2.x
- Moqui Framework integration

---
*This issue was automatically created by the Durion Workspace Agent*

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ISSUE #125: [FRONTEND] [STORY] Security: Audit Trail for Schedule and Assignment Changes â€” URL: https://github.com/louisburroughs/durion-moqui-frontend/issues/125
File: ./scripts/story-work/frontend/125/after.md
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## ğŸ·ï¸ Labels (Proposed)

### Required
- type:story
- domain:audit
- status:draft

### Recommended
- agent:audit-domain-agent
- agent:story-authoring

### Blocking / Risk
- blocked:clarification
- risk:incomplete-requirements

**Rewrite Variant:** security-strict

STOP: Clarification required before finalization

---

## 1. Story Header

### Title
[FRONTEND] [STORY] Audit: View/Search Audit Trail for Schedule & Assignment Changes

### Primary Persona
Shop Manager

### Business Value
Provide a persistent, immutable, and searchable audit history of scheduling and mechanic assignment changes so Shop Managers can investigate discrepancies, resolve disputes, and support compliance/accountability.

---

## 2. Story Intent

### As a / I want / So that
- **As a** Shop Manager  
- **I want** to view and search audit history for schedule and mechanic assignment changes (including who/when/what changed and why)  
- **So that** I can explain conflicts, resolve disputes, and demonstrate operational accountability.

### In-scope
- New/updated Moqui **screens** in the frontend to:
  - Search audit logs by required filters (appointment/work order/mechanic plus date range and additional filters as available).
  - View audit log list results (reverse chronological).
  - View audit log detail (including normalized fields + raw payload when available).
- UI handling for immutability (read-only) and authorization failures.
- UI integration points (â€œdeep linksâ€) back to workexec entities **if provided by backend**.

### Out-of-scope
- Producing audit events (workexec outbox/eventing) and audit persistence/retention enforcement (backend responsibility).
- Creating/updating/deleting audit records (must not exist in UI).
- Managing reason code registry (unless an explicit query endpoint exists and is required by UI; currently unspecified).

---

## 3. Actors & Stakeholders
- **Shop Manager (primary):** Searches and reviews audit history.
- **Compliance Auditor / Support (secondary):** May use the same UI for investigations (role-gated).
- **Service Advisor / Dispatcher (implicit):** Appears as â€œactorâ€ on audit entries.
- **System:** Provides audit search and detail endpoints; enforces tenant/location isolation.

---

## 4. Preconditions & Dependencies
- User is authenticated and has an active **tenant** context; location context is available (explicit selection or derived).
- Backend audit services exist (or will exist) to:
  - Search/list audit logs with filters and pagination.
  - Retrieve audit log detail by `eventId`.
- Backend returns fields required for rendering:
  - `eventId`, `occurredAt`/timestamp (UTC), actor identity, entity/aggregate references, eventType, reasonCode/reasonNotes, change summary text and/or patch, and optionally raw payload and deep-link metadata.
- Authorization model exists for audit viewing/export (exact roles/permissions currently unclear; see Open Questions).

---

## 5. UX Summary (Moqui-Oriented)

### Entry points
- From POS navigation: **Security / Audit** (or equivalent admin/manager area).
- Contextual entry points (optional if provided): â€œView Audit Historyâ€ link from:
  - Work Order detail
  - Appointment detail
  - Mechanic profile  
  (These contextual links pre-fill filters; whether these screens exist in this frontend is unknownâ€”see Open Questions.)

### Screens to create/modify
- **Create** `apps/pos/screen/audit/AuditLogSearch.xml` (name illustrative; final path must follow repo conventions)
  - Search form + results grid.
- **Create** `apps/pos/screen/audit/AuditLogDetail.xml`
  - Read-only audit entry detail view.
- **Modify** navigation/menu screen to add â€œAudit Logsâ€ entry (location depends on existing nav structure).

### Navigation context
- `AuditLogSearch` â†’ selecting a result row navigates to `AuditLogDetail` with `eventId`.
- `AuditLogDetail` includes â€œBack to resultsâ€ preserving prior search parameters (Moqui parameter pass-through).

### User workflows
**Happy path (search + view):**
1. Shop Manager opens Audit Logs.
2. Sets date range + optional filters (workOrderId / appointmentId / mechanicId / actor / eventType / location).
3. Runs search; sees results sorted newest-first.
4. Clicks an entry; sees detail including diff summary, structured patch (if present), reason code/notes, and cross-domain references.

**Alternate paths:**
- No results â†’ show empty state with suggestion to broaden filters.
- Unauthorized â†’ show access denied screen/message.
- Backend error â†’ show non-PII error banner and allow retry.

---

## 6. Functional Behavior

### Triggers
- User navigates to Audit Logs screen.
- User submits search form.
- User opens an audit record detail.

### UI actions
- Search form actions:
  - Set `dateFrom` and `dateTo` (required unless backend provides defaulting).
  - Enter exact-match identifiers: `workOrderId`, `appointmentId`, `mechanicId`.
  - Select `eventType` (if backend provides enumerations or free text entry if not).
  - Enter `actorUserId` (exact) or actor search (if backend supports).
  - Select `locationId` (required if not implicit in session).
- Results list actions:
  - Pagination (next/prev, page size up to max).
  - Sort is fixed to reverse chronological unless backend supports alternate sort (not required).
  - Open detail view by `eventId`.

### State changes
- No domain state changes; UI is read-only.
- UI state: query params, results list, selected record.

### Service interactions
- On screen load: optionally load defaults (current tenant, location options, eventType options) if endpoints exist.
- On search: call audit query service (see Service Contracts).
- On detail: call audit detail service by `eventId`.

---

## 7. Business Rules (Translated to UI Behavior)

### Validation
- **Date range**:
  - UI must require `start` and `end` date/time **unless** backend guarantees a safe default (e.g., last 90 days). In strict mode, treat as required until confirmed.
  - Validate `start <= end`.
  - Validate max range if backend enforces one (unknown; see Open Questions).
- **Exact match identifiers**:
  - `workOrderId`, `appointmentId`, `mechanicId`, `actorUserId` are treated as exact strings; no formatting assumptions.
- **Reason code**:
  - Display `reasonCode` as provided (namespaced code) and `reasonNotes` if present.
  - Do not allow editing.

### Enable/disable rules
- â€œSearchâ€ button disabled until required fields are valid (at minimum date range).
- â€œView detailâ€ enabled only when `eventId` is present.

### Visibility rules
- If structured patch exists â†’ show â€œChange Detailsâ€ section.
- If only human-readable summary exists â†’ show summary.
- If raw payload exists â†’ show expandable/collapsible raw JSON view (read-only).
- If deep-link metadata exists â†’ show â€œOpen Source Recordâ€ link(s); otherwise hide.

### Error messaging expectations
- Validation errors: inline field messages (â€œStart date is requiredâ€, â€œEnd date must be after start dateâ€).
- Authorization: show â€œYou do not have permission to view audit logs.â€
- Backend errors: generic banner (â€œUnable to load audit logs. Please retry.â€) plus correlation/reference id if returned.

---

## 8. Data Requirements

### Entities involved (frontend perspective)
- `AuditLog` (read-only, from backend)
- `ReasonCode` registry (read-only, only if backend provides endpoint for display names; otherwise display code as-is)

### Fields (type, required, defaults)
**AuditLog list item (minimum render set):**
- `eventId` (string, required) â€” primary key for detail navigation
- `occurredAt` or `timestamp` (datetime string, required) â€” display in userâ€™s locale, sourced as UTC
- `eventType` (string, required)
- `aggregateType` / `entityType` (string, required)
- `aggregateId` / `entityId` (string, required)
- `actor.id` / `actorId` (string, required)
- `actor.displayName` (string, optional)
- `locationId` (string, required for filtering/display if multi-location)
- `changeSummaryText` (string, optional)
- `reasonCode` (string, optional)
- `reasonNotes` (string, optional)

**AuditLog detail (additional):**
- `schemaVersion` (string/int, optional but expected)
- `emittedAt` (datetime, optional)
- `correlationId` (string, optional but preferred)
- `changePatch` (JSON array/object, optional)
- `rawPayload` (JSON/text, optional)
- `sourceSystem` (string, optional)
- `deepLinks` / link metadata (optional)

### Read-only vs editable by state/role
- All audit fields are read-only for all roles in this story.

### Derived/calculated fields
- â€œWhenâ€ display: convert UTC timestamp to user locale/timezone for display; retain UTC in raw view.
- Display actor: prefer `actor.displayName`, fallback to `actorId`.

---

## 9. Service Contracts (Frontend Perspective)

> Backend API/service names are not specified in provided inputs. Moqui screens must call services; until exact service names/paths are confirmed, implement using placeholders and mark as blocking.

### Load/view calls
- **Load search screen context (optional):**
  - `audit.getSearchContext` (placeholder)
    - returns available `locationId` options (if needed) and `eventType` options (if provided).

### Create/update calls
- None (immutability).

### Submit/transition calls
- **Search/list audit logs:**
  - `audit.findAuditLogs` (placeholder)
  - Request params (AND semantics):
    - `dateFrom` (UTC datetime, required)
    - `dateTo` (UTC datetime, required)
    - `workOrderId` (optional, exact)
    - `appointmentId` (optional, exact)
    - `mechanicId` (optional, exact)
    - `actorUserId` (optional, exact)
    - `eventType` (optional)
    - `locationId` (optional/required depending on tenant model)
    - pagination: `pageIndex`/`offset`, `pageSize`/`limit`
  - Response:
    - `results[]` list of normalized audit entries (fields above)
    - pagination metadata (total count or next cursor)

- **Get audit log detail by eventId:**
  - `audit.getAuditLog` (placeholder)
  - Request: `eventId` (required)
  - Response: full record including raw payload, patch, correlationId, schemaVersion.

### Error handling expectations
- 400: field-level validation errors displayed inline (e.g., invalid date range).
- 401/403: redirect to login or show forbidden.
- 404 on detail: show â€œAudit record not foundâ€ with eventId.
- 429: show rate limit message and retry option.
- 5xx: show generic error banner; log correlation id if present.

---

## 10. State Model & Transitions

### Allowed states
- Audit records: immutable (no state transitions exposed to UI).

### Role-based transitions
- Only â€œviewâ€ actions; no transitions.

### UI behavior per state
- N/A; read-only views only.

---

## 11. Alternate / Error Flows

### Validation failures
- Missing date range â†’ prevent search; show inline errors.
- Start > end â†’ prevent search; show inline errors.
- Invalid identifier formats â†’ no strict validation unless backend defines formats; treat as opaque strings.

### Concurrency conflicts
- If detail fetch returns not found (record aged out or incorrect id) â†’ show not found state and link back to search.

### Unauthorized access
- If user lacks permission to access audit search/detail:
  - Search screen: show forbidden state, do not attempt queries repeatedly.
  - Deep links: hide if unauthorized/unknown.

### Empty states
- No results: show â€œNo audit entries found for selected filtersâ€ and provide â€œClear filtersâ€ action.

---

## 12. Acceptance Criteria (Gherkin)

### Scenario 1: Search audit logs by work order within date range
**Given** I am logged in as a Shop Manager with permission to view audit logs  
**And** I am on the Audit Logs search screen  
**When** I enter a date range from "2026-01-01T00:00:00Z" to "2026-01-31T23:59:59Z"  
**And** I enter workOrderId "WO-123"  
**And** I run the search  
**Then** I see a list of audit entries filtered to workOrderId "WO-123"  
**And** the list is sorted in reverse chronological order by occurredAt/timestamp  
**And** each row shows occurredAt, actor, eventType, and a change summary (text or indicator).

### Scenario 2: Search audit logs by mechanic within date range
**Given** I am logged in as a Shop Manager with permission to view audit logs  
**When** I search with a valid date range and mechanicId "M-456"  
**Then** I see audit entries related to mechanic assignment changes for "M-456" (as represented by aggregate/entity references in results).

### Scenario 3: View audit log detail
**Given** I have search results on the Audit Logs screen  
**When** I select an audit entry with eventId "EVT-001"  
**Then** I navigate to the Audit Log detail screen for "EVT-001"  
**And** I can see eventId, occurredAt (displayed in my locale), actor, eventType, entity/aggregate type and id  
**And** I can see reasonCode and reasonNotes if present  
**And** I can see changePatch and/or changeSummaryText if present  
**And** the audit record is read-only (no edit or delete actions are available).

### Scenario 4: Enforce required date range validation in UI
**Given** I am on the Audit Logs search screen  
**When** I attempt to search without setting a start and end date  
**Then** the search is not submitted  
**And** I see inline validation errors indicating the date range is required.

### Scenario 5: Unauthorized user cannot view audit logs
**Given** I am logged in as a user without permission to view audit logs  
**When** I navigate to the Audit Logs screen  
**Then** I see an access denied message  
**And** no audit data is displayed.

### Scenario 6: Audit log detail not found
**Given** I navigate directly to the Audit Log detail screen with eventId "EVT-NOT-FOUND"  
**When** the backend returns a not-found response  
**Then** I see a â€œnot foundâ€ state  
**And** I can navigate back to the Audit Logs search screen.

---

## 13. Audit & Observability

### User-visible audit data
- Display key normalized fields: occurredAt, actor, eventType, aggregate/entity references, reason code/notes, summary/patch.
- Display correlationId if provided to aid support investigations.

### Status history
- Not applicable beyond the audit record itself; no UI-driven status changes.

### Traceability expectations
- UI should preserve and pass through `correlationId` when present in responses into frontend logs (console/app log) for troubleshooting (avoid exposing sensitive raw payload by default).
- If backend provides deep-link metadata (entityType/entityId), show navigation back to workexec screens when available.

---

## 14. Non-Functional UI Requirements

- **Performance:** Search results must paginate; do not attempt to render unbounded lists. Page size must respect backend maximums.
- **Accessibility:** All form controls labeled; keyboard navigable; error messages associated with fields.
- **Responsiveness:** Works on tablet/desktop; results table supports horizontal scroll if needed.
- **i18n/timezone:** Display timestamps localized for the user, but preserve UTC in raw views. Currency not applicable.

---

## 15. Applied Safe Defaults
- none

---

## 16. Open Questions

1. **Backend service contract:** What are the exact Moqui service names (and parameter/response field names) for:
   - audit search/list (filters + pagination)
   - audit detail by `eventId`
   - optional search context (eventType list, location list)?
2. **Authorization model:** What permission/role(s) in this frontend control access to audit search and detail (e.g., Shop Manager, Compliance, Support)? Is there a specific permission string to check in Moqui screens?
3. **Navigation placement:** Where should â€œAudit Logsâ€ live in the POS navigation (menu structure), and should there be contextual links from Work Order / Appointment / Mechanic screens in this frontend?
4. **Filter requirements:** Is `locationId` required in the UI (multi-location tenants), or is location implicit from the logged-in session context?
5. **Date range limits:** Does backend enforce a maximum date range window per query (e.g., max 90 days), and should UI enforce the same?
6. **EventType vocabulary:** Should eventType be a controlled dropdown (requires endpoint/enum) or free-text filter?
7. **Reason code display:** Will backend return `reasonCode` only, or also `displayName/description` from the audit-owned registry for UI display?

---

## Original Story (Unmodified â€“ For Traceability)

Title: [FRONTEND] [STORY] Security: Audit Trail for Schedule and Assignment Changes â€” URL: https://github.com/louisburroughs/durion-moqui-frontend/issues/125

Labels: frontend, story-implementation, user

## Frontend Implementation for Story

**Original Story**: [STORY] Security: Audit Trail for Schedule and Assignment Changes

**Domain**: user

### Story Description

/kiro
# User Story
## Narrative
As a **Shop Manager**, I want an audit history of schedule and assignment changes so that we can explain conflicts and resolve disputes.

## Details
- Record diff summary, actor, timestamp, reason codes.
- Immutable audit log.

## Acceptance Criteria
- Every change audited.
- Search by appointment/workorder/mechanic.

## Integrations
- Include workexec refs for cross-domain traceability.

## Data / Entities
- AuditLog, AuditDiffSummary

## Classification (confirm labels)
- Type: Story
- Layer: Domain
- Domain: Shop Management


### Frontend Requirements

- Implement Vue.js 3 components with TypeScript
- Use Quasar framework for UI components
- Integrate with Moqui Framework backend
- Ensure responsive design and accessibility

### Technical Stack

- Vue.js 3 with Composition API
- TypeScript 5.x
- Quasar v2.x
- Moqui Framework integration

---
*This issue was automatically created by the Durion Workspace Agent*

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ISSUE #86: [FRONTEND] [STORY] Security: Immutable Audit Trail for Movements and Workorder Links
File: ./scripts/story-work/frontend/86/after.md
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STOP: Clarification required before finalization

## ğŸ·ï¸ Labels (Proposed)

### Required
- type:story
- domain:audit
- status:draft

### Recommended
- agent:security
- agent:story-authoring

### Blocking / Risk
- blocked:clarification
- risk:incomplete-requirements

**Rewrite Variant:** security-strict

---

## 1. Story Header

### Title
Security: Immutable Audit Trail UI for Inventory Movements and Workorder Links (Drilldown + Export)

### Primary Persona
Auditor (read-only, compliance-oriented)

### Business Value
Enables dispute resolution and compliance by providing immutable, append-only audit trails that can be searched/drilled down by workorder/product/location/user and exported for external review.

---

## 2. Story Intent

### As a / I want / So that
- **As an** Auditor  
- **I want** immutable (append-only) audit trails for inventory movements and their workorder links, with drilldowns by workorder/product/location/user and export  
- **So that** I can reconstruct what happened, by whom, and why, to resolve disputes and support compliance.

### In-scope
- Frontend screens to:
  - Search and view audit logs for movement details and references (workorder links).
  - Drill down (filter + navigate) by **workorder**, **product**, **location**, **user**.
  - Export audit results (at minimum CSV; format(s) TBD).
- UI enforcement of â€œappend-onlyâ€ semantics:
  - No create/edit/delete actions exposed from UI for audit records.
  - Read-only presentation and navigation only.
- Moqui screen/form/service wiring for list/detail + export invocation.

### Out-of-scope
- Defining or implementing backend persistence, immutability guarantees, or event generation (no backend matches found).
- Retroactive backfill/migration of historical audit data.
- Defining permission model/roles beyond â€œAuditor can view/exportâ€ (requires clarification).
- Any accounting/ledger calculation policies beyond displaying existing â€œledger referencesâ€.

---

## 3. Actors & Stakeholders
- **Auditor**: primary user; needs read-only visibility, filters, export.
- **Operations Manager** (stakeholder): may use audit during disputes.
- **Inventory Clerk** (stakeholder): may be subject of audit (user drilldown).
- **Security/Compliance** (stakeholder): cares about immutability, access control, traceability.
- **Workexec system/process** (external stakeholder): â€œuses ledger references for traceabilityâ€.

---

## 4. Preconditions & Dependencies
- Moqui backend must expose read-only services or screen data sources for:
  - `AuditLog` retrieval (list + detail).
  - `MovementReferenceIndex` retrieval (movement â†” references, and drilldown keys).
  - `WorkorderRef` retrieval (workorder link metadata).
- Backend must define:
  - Stable identifiers for movement, workorder, product, location, user.
  - What constitutes â€œmovementâ€ in UI terms (movementId? inventoryTransferId? etc.).
  - Export endpoint/behavior (sync download vs async job).
- Authentication must exist; authorization rules for audit access must be specified (blocking).

---

## 5. UX Summary (Moqui-Oriented)

### Entry points
- Main navigation: **Security/Compliance â†’ Audit Trail**
- Contextual links (if available in existing app):
  - From Movement detail â†’ â€œView Audit Trail for this Movementâ€
  - From Workorder detail â†’ â€œView Movement Audit Trail for this Workorderâ€
  - From Product/Location/User pages â†’ â€œView Audit Trailâ€ pre-filtered

### Screens to create/modify
Create (names are proposed; adjust to repo conventions):
- `component://durion/screen/audit/AuditTrail.xml`
  - Subscreens:
    - `AuditTrailList.xml` (search + results table)
    - `AuditTrailDetail.xml` (read-only record detail)
    - `AuditTrailExport.xml` (transition/service to generate/download export)

Modify (optional, if existing):
- Movement detail screen(s): add transition/link to `AuditTrailList` with movement filter.
- Workorder detail screen(s): add transition/link to `AuditTrailList` with workorder filter.

### Navigation context
- `AuditTrailList` supports deep-link query params:
  - `workorderId`, `productId`, `locationId`, `userId`, `movementId`
  - `fromTs`, `thruTs`
- Clicking a row navigates to `AuditTrailDetail` for that audit record.

### User workflows
**Happy path (search + drilldown):**
1. Auditor opens Audit Trail.
2. Sets filters (date range + any of workorder/product/location/user).
3. Reviews results list.
4. Clicks a record to view details; optionally jumps to related workorder/movement (read-only) if links exist.
5. Exports filtered results.

**Alternate path (start from workorder):**
1. Auditor opens Workorder detail.
2. Clicks â€œAudit Trailâ€.
3. Lands in Audit Trail list pre-filtered to that workorder.

**Alternate path (no results):**
- UI shows empty state + keeps filter controls visible; export disabled until results exist (or clarified).

---

## 6. Functional Behavior

### Triggers
- Screen load of `AuditTrailList` triggers a search (only if minimal criteria met; criteria TBD) or shows blank state awaiting filters (blocking).
- â€œSearchâ€ button triggers service call to load list.
- Clicking a record triggers load of record detail.
- â€œExportâ€ triggers export service call for current filters.

### UI actions
On `AuditTrailList`:
- Filter inputs:
  - Workorder (by ID or lookup)
  - Product (by ID or lookup)
  - Location (by ID or lookup)
  - User (by ID or lookup)
  - Movement (by ID)
  - Date range (from/thru)
- Results table columns (proposed; backend must confirm available fields):
  - Timestamp
  - Actor (user)
  - Action/Event type
  - Entity type (Movement / WorkorderRef / ReferenceIndex)
  - Primary entity ID (movementId/workorderId/etc.)
  - Location (if applicable)
  - Product (if applicable)
  - Ledger reference (if applicable)
- Row action: View details
- Button: Export (CSV/JSON/PDF TBD)

On `AuditTrailDetail`:
- Read-only fields: all raw audit payload + normalized fields
- Related links (if IDs present): movement, workorder, product, location, user

### State changes
- None in domain data (audit is immutable). Only client-side state: filters, paging, selected record.

### Service interactions
- `findAuditLogs` (list)
- `getAuditLog` (detail)
- `exportAuditLogs` (export)
> Service names are placeholders; backend contract required.

---

## 7. Business Rules (Translated to UI Behavior)

### Validation
- Date range validation:
  - `fromTs` must be â‰¤ `thruTs`
  - timezone handling must be explicit (blocking: which timezone to interpret filters in)
- At least one filter requirement (to prevent unbounded queries) is **unknown**:
  - If backend requires a date range and/or at least one drilldown key, UI must enforce it (blocking).

### Enable/disable rules
- â€œSearchâ€ enabled when validation passes and required criteria satisfied (criteria TBD).
- â€œExportâ€ enabled when:
  - A valid filter set exists, and
  - Search has returned at least one result (or backend supports exporting empty set; TBD).

### Visibility rules
- No â€œAdd/Edit/Deleteâ€ controls anywhere for audit entities.
- If user lacks permission: show â€œNot authorizedâ€ screen and do not leak counts/fields.

### Error messaging expectations
- Show backend validation errors inline on filter form when mapped to fields.
- Show generic error banner for unexpected errors with a correlation/trace id if available.

---

## 8. Data Requirements

### Entities involved (as provided)
- `AuditLog`
- `MovementReferenceIndex`
- `WorkorderRef`

### Fields (type, required, defaults)
**AuditLog** (minimum needed; backend must confirm exact schema)
- `auditLogId` (string/ID, required, read-only)
- `eventTs` (datetime, required, read-only)
- `eventType` (string, required, read-only)
- `actorUserId` (string/ID, optional?, read-only)
- `entityType` (string, required, read-only)
- `entityId` (string/ID, required, read-only)
- `workorderId` (string/ID, optional, read-only) â€” if denormalized or via reference index
- `productId` (string/ID, optional, read-only)
- `locationId` (string/ID, optional, read-only)
- `movementId` (string/ID, optional, read-only)
- `ledgerRef` (string, optional, read-only)
- `payloadJson` (text/json, optional, read-only)
- `hash` / `prevHash` (string, optional, read-only) â€” if immutability chain is exposed (blocking)

**MovementReferenceIndex / WorkorderRef**
- Fields must support drilldown keys and linking:
  - `movementId`, `workorderId`, `referenceType`, `referenceId`, etc. (TBD)

### Read-only vs editable by state/role
- All fields are **read-only for all roles** in frontend.
- Only authorized roles can view/export (exact roles TBD).

### Derived/calculated fields
- Display-friendly actor name derived from userId (requires lookup service; TBD).
- Display-friendly product/location names derived from IDs (requires lookup service; TBD).

---

## 9. Service Contracts (Frontend Perspective)

> No backend matches found; contracts are blocking. Below are required contracts.

### Load/view calls
1. **List audit logs**
   - Input: filters `{fromTs, thruTs, workorderId, productId, locationId, userId, movementId, pageIndex, pageSize, sort}`
   - Output: `{items: AuditLogSummary[], totalCount}`
   - Must support server-side paging and sorting.

2. **Get audit log detail**
   - Input: `{auditLogId}`
   - Output: `{auditLog: AuditLogDetail}`

3. **Lookup helpers** (if UI includes search/select controls)
   - Users: `{query}` â†’ `{userId, displayName}`
   - Products: `{query}` â†’ `{productId, productName}`
   - Locations: `{query}` â†’ `{locationId, locationName}`
   - Workorders: `{query}` â†’ `{workorderId, workorderName/code}`

### Create/update calls
- None (UI must not call any create/update for audit).

### Submit/transition calls
4. **Export audit logs**
   - Input: same filters as list + `format`
   - Output options (backend must choose one):
     - (A) immediate file download response, or
     - (B) returns `exportJobId` and a follow-up download URL/status polling endpoint.

### Error handling expectations
- 401/403: route to unauthorized screen; no partial rendering.
- 400 validation: show field-level errors where possible.
- 409 concurrency: not expected for read-only, but handle stale export job state if async.
- 5xx: show error banner; allow retry.

---

## 10. State Model & Transitions

### Allowed states
- Not applicable to audit entities in UI (immutable, append-only).

### Role-based transitions
- Role/action matrix (blocking):
  - Auditor: View list, View detail, Export
  - Others: ? (unknown)

### UI behavior per state
- If not authorized: show unauthorized.
- If authorized: read-only access, no mutation controls.

---

## 11. Alternate / Error Flows

### Validation failures
- Invalid date range â†’ block search/export; show inline message: â€œFrom must be before Thru.â€
- Missing required criteria (if mandated) â†’ block search; message: â€œSelect at least one filterâ€ or â€œDate range requiredâ€ (TBD).

### Concurrency conflicts
- Export async job: job expired/not found â†’ show message and allow re-run export.

### Unauthorized access
- Direct URL access to detail without permission â†’ unauthorized view; do not reveal record existence.

### Empty states
- No results found â†’ show â€œNo audit records match these filters.â€
- No backend service available â†’ show error banner + retry.

---

## 12. Acceptance Criteria (Gherkin)

### Scenario: View audit trail list with filters
Given I am authenticated as a user with audit viewing permission  
And I navigate to the Audit Trail screen  
When I enter a valid date range and a workorder filter  
And I click Search  
Then I see a paginated list of audit records matching the filters  
And each row shows timestamp, actor, event type, entity type, and entity id

### Scenario: Drill down to audit detail
Given I have searched and see at least one audit record  
When I click an audit record row  
Then I am navigated to the Audit Trail Detail screen  
And I see the full read-only audit payload and all available reference fields  
And there are no edit or delete controls

### Scenario: Export filtered audit results
Given I am viewing audit results for a valid filter set  
When I click Export and choose CSV  
Then an export is generated for the same filter set  
And I can download the exported file (or I see an export job status until it is downloadable)

### Scenario: Prevent mutation from the UI
Given I am on any Audit Trail screen  
Then I cannot create, edit, or delete any audit record  
And no mutation actions are present in the UI

### Scenario: Unauthorized user is blocked
Given I am authenticated as a user without audit viewing permission  
When I navigate to the Audit Trail screen or a deep link to an audit record  
Then I see an unauthorized message  
And no audit data is displayed

### Scenario: Invalid date range is rejected
Given I am on the Audit Trail screen  
When I set From to a value after Thru  
Then Search is disabled (or returns a validation error)  
And I see an inline validation message explaining the issue

---

## 13. Audit & Observability

### User-visible audit data
- Display immutable audit fields including timestamp, actor, event type, entity identifiers, and ledger references where present.

### Status history
- Not applicable (audit records are history themselves). If audit chains (hash/prevHash) exist, display them read-only (blocking: whether present).

### Traceability expectations
- All drilldowns must preserve filters in URL query params for shareable links.
- Log frontend actions (search, detail view, export) with correlation id if Moqui provides one.

---

## 14. Non-Functional UI Requirements

- **Performance:** List queries must be paginated; avoid loading full dataset.
- **Accessibility:** All interactive controls keyboard-navigable; table has accessible labels; export action reachable without pointer.
- **Responsiveness:** Filters and results usable on tablet widths; table supports horizontal scroll if needed.
- **i18n/timezone:** Timestamps rendered in a clearly defined timezone (blocking which); date pickers respect locale.
- **Security:** No sensitive payload fields should be displayed if backend marks them restricted (blocking: field-level security rules).

---

## 15. Applied Safe Defaults
- SD-UX-EMPTY-STATE: Provide a standard â€œNo resultsâ€ empty state with guidance to adjust filters; qualifies as safe because it does not change domain policy. (Impacted: UX Summary, Alternate / Error Flows)
- SD-UX-PAGINATION: Use server-side pagination defaults (pageSize 25, configurable) to prevent unbounded loads; safe because itâ€™s UI ergonomics and performance only. (Impacted: Functional Behavior, Service Contracts)
- SD-ERR-GENERIC-BANNER: Show a generic error banner for unexpected failures with retry; safe because it doesnâ€™t alter domain behavior. (Impacted: Business Rules, Alternate / Error Flows)

---

## 16. Open Questions

1. **Domain label conflict:** Provided context says â€œDomain: userâ€ and â€œClassification: Domain: Inventory Managementâ€; should this story be owned by **domain:audit** (security/compliance) or **domain:inventory**? (Blocking)
2. **Backend contracts:** What are the exact Moqui service names/parameters for:
   - list audit logs, get audit detail, export audit logs, and lookups? (Blocking)
3. **Authorization:** What permission(s)/role(s) grant view and export access? Is field-level redaction required for `payloadJson`? (Blocking)
4. **Filter constraints:** Must the UI require a date range and/or at least one drilldown key to search/export? What maximum date range is allowed? (Blocking; policy)
5. **Immutability proof:** Does backend expose hash-chain fields (hash/prevHash/signature) that should be displayed/verified in UI? (Blocking)
6. **Export format & behavior:** Required export formats (CSV only vs CSV+JSON/PDF)? Synchronous download vs async job? Filename convention? (Blocking)
7. **Entity identifiers:** What are the canonical IDs for movement/workorder/product/location/user in this system, and are they always present on `AuditLog` or only via reference entities? (Blocking)
8. **Navigation targets:** Should drilldown links navigate to Movement/Workorder/Product/Location/User detail screens? If yes, what are the route/screen names? (Blocking)

---

## Original Story (Unmodified â€“ For Traceability)

Title: [FRONTEND] [STORY] Security: Immutable Audit Trail for Movements and Workorder Links
URL: https://github.com/louisburroughs/durion-moqui-frontend/issues/86
Labels: frontend, story-implementation, user

## Frontend Implementation for Story

**Original Story**: [STORY] Security: Immutable Audit Trail for Movements and Workorder Links

**Domain**: user

### Story Description

/kiro
# User Story
## Narrative
As an **Auditor**, I want immutable audit trails for movements and workorder links so that disputes can be resolved.

## Details
- Append-only logs for move details and references.
- Drilldown by workorder/product/location/user.

## Acceptance Criteria
- Audit append-only.
- Drilldown supported.
- Exportable.

## Integrations
- Workexec uses ledger references for traceability.

## Data / Entities
- AuditLog, MovementReferenceIndex, WorkorderRef

## Classification (confirm labels)
- Type: Story
- Layer: Domain
- Domain: Inventory Management


### Frontend Requirements

- Implement Vue.js 3 components with TypeScript
- Use Quasar framework for UI components
- Integrate with Moqui Framework backend
- Ensure responsive design and accessibility

### Technical Stack

- Vue.js 3 with Composition API
- TypeScript 5.x
- Quasar v2.x
- Moqui Framework integration

---
*This issue was automatically created by the Durion Workspace Agent*

====================================================================================================


No backend matches found.

